# Звіт до тестового завдання змагання Int20h_DS від команди ММФ

## Contents

0. [Зміст репозиторію](#зміст-репозиторію)
1. [Аналіз даних](#аналіз-даних)
2. [Обробка даних](#обробка-даних)
3. [Відбір ознак](#відбір-ознак)
4. [Висновок](#висновок)

## Зміст репозиторію

- int20h_ds_test_Date_analysis_and_preprocessing.ipynb - Блокнот в якому ми проводили аналіз даних та створювали датасет
- int20h_ds_test_features_importances.ipynb - Блокнот в якому ми аналізували важливість ознак

P.S. Фактично в цих блокнотах немає інформації, якої Ви не знайдете у цьому звіті. Ми просто вирішили додати свої робочі блокноти, можливо вони будуть корисні)))

## Аналіз даних

Переглянули типи даних та можливі пропуски. У важливих колонках відсутніх даних не було, тому можна працювати. 

Потрібно було вирішити одне з головних питання - яких користувачів треба аналізувати. Ми припустили, що важливі користувачі це ті, хто придбали, відновили або скасували преміум підписку. Поділимо усіх користувачів на 2 групи за цим признаком і проаналізуємо.

Наша гіпотеза, відносно дій з підпискою, підтвердилась. Користувачі, котрі не мали хоч одну з цих дій є в основному неактивними і не цікаві для вирішення даного завдання. Але також були користувачі, які виконували багато замовлень, але вже були із преміум підпискою (“Order” - “Premium Membership : True”). Схоже на те, що вони вже мали підписку до початку збору даних. Отже, ми їх додаємо до “пулу цікавих” користувачів.

Також побачили деякі аномалії:  користувачі з дублюванням логів (наприклад “userid” b288242d86302c56eb49562a7d73a5f2 , у якого двічі відбувається скасування підписки підряд)

Після цього ми відсіяли неактивних користувачів і продовжили працювати лише з “цікавими” користувачами.

PS. При перегляді користувачів без підписки, ми побачили, що більшість користувачів перестають користуватись сервісом з такими останніми логами в категорії “event_name”:
1) Calculator View - схоже занадто дорогі ціни, можна запропонувати знижку для перших разу користування сервісом
2) Add Vehicle Break - люди не можуть додати машину, можливо потрібна більш детальна інструкція

## Обробка даних

Ми вирішили підійти до розв’язку даного завдання статистично - кожного користувача максимально детельно описати статичними метриками, незважаючи на динамікй його дій.

Тому спочатку подивились на всі атрибути для кожного “event_name”  і виділили, як на нашу думку, найбільш цікаві (так як це не фінальні фічі, дивись у файлі з аналізом даних).

Надалі в нашій збірці вирішили використовувати 3 джерела для даних:
1. Дані, які були в початковому датасеті: "user_state", "event_platform", "device_manufacture", "device_model"
2. Скільки разів кожен івент був у кожного користувача
3. З якими атрибутами був цей івент

Коли отримали повни датасет,  побачили, що в нас вийшло дуже багато категоріальних ознак з великою кількістю унікальних значень, тому необхідно  зменшити розмір нашого датасету.

Тому ми вирішили прибрати частину ознак з частин 1 та 3 і залишити ось такі ознаки:

- "user_state"
- "event_platform"
- "Add_Vehicle_Success_Year"
- "Add_Vehicle_Success_Temporary"
- "Add_Vehicle_Success_Make"
- "Add_Payment_Method_Success_Payment_Method"
- "Sign_Up_Success_Method"
- "Add_Payment_Method_Failed_Error_Code"
- "Transaction_Refund_Amount"
- "Chat_Conversation_Opened_Transaction_type"
- "Account_History_Transaction_Details_Navigated_From"
- "Account_History_Transaction_Details_Status"
- "Account_History_Transaction_Details_Type"
- "Order_Premium_Membership"
- "Add_Vehicle_Failed_Error_Code"
- "Subscription_Premium_Renew_Membership_Type"
- "Subscription_Premium_Membership_Type"

Для більшості категоріальних ознак, ми використали OneHotEncoding з рахунком кількості випадків (наприклад, якщо у користувача 2 машини Mazda в колонці Add_Vehicle_Success_Make, то після OHE ми залишимо “2” в колонці Add_Vehicle_Success_Make_Mazda)

Також деякі ознаки обробляли по іншому  (наприклад, якщо у користувача було кілька повернень в колонці "Transaction_Refund_Amount", то ми їх сумували або якщо користувач добавляв кілька машин, то з колонки "Add_Vehicle_Success_Year" ми отримували дві ознаки - середнє по роках і максимальний рік, і тд.). Більш детально дивись у файлі з аналізу даних.

У кінцевому результаті ми отримали датасет (812х148).


## Відбір ознак

Ми вирішили використати аналіз важливості ознак на основі ML алгоритмів: Linear Regression і RandomForest. Тож для початку ми підготували дані для лінійну регресії, тобто: 
-	нормалізували дані
-	перевірили дані на мулькорелеальнітсь, прибрали скорельовані ознаки
-	лінеаризували деякі чисельні ознаки 

Після цього побудували лінійну регресію на основі OLS алгоритму і переглянули результати моделі (точність моделі, описану дисперсію для кожної ознаки та p-value, того що ця дисперсія не є випадкова). Так як, наша модель видавала досить непоганий результат, то ми можемо зробити висновки про важливість ознак. Критерієм важливості ознаки було значення p-value, яке менше за 0.05. Ми отримали такі ознаки із відповідними коефіцієнтами:

- Add_Vehicle_Success_Make_Buick : 0.3666850073729535
- Chat Conversation Opened : 1.3032505832860295
- Add Payment Method Success : -0.25989784918241204
- Add_Vehicle_Success_Make_Lincoln : 0.6522399160906713
- Chat Conversation Started : 1.3327272422155165
- Add_Vehicle_Success_Make_Oldsmobile : 1.2106516192376642
- user_state_NY : -0.1676336040382052
- Subscription Premium Renew : -0.1786837304105095
- Wallet Opened : 1.093671682522929
- user_state_TN : 0.7422143878073315
- Account Setup Profile Skip : 0.2256374749752183
- Sign Out : 0.7109409772512834
- Order_Premium_Membership_True : -0.3420557653572363
- Subscription_Premium_Renew_Membership_Type_Yearly : -0.0827113732738203
- Subscription_Premium_Renew_Membership_Type_Monthly : -0.15111327264981012
- Transaction Refund : 1.1803179942305673
- Add_Vehicle_Success_Make_Jaguar : -1.3612160638778035
- Calculator View : -0.3579686588102027
- Add_Vehicle_Success_Temporary_false : -0.3643493228345238
- Add_Payment_Method_Success_Payment_Method_Debit : -0.18578420084471758
- Add Vehicle Break : -0.412559743635933
- Order : -0.32397973298003435
- Chat_Conversation_Opened_Transaction_type_AutoPayment : -0.8651536320015272

Для додаткової перевірки отриманих результатів, ми вирішили використати алгоритм RandomForest для перегляду важливих ознак. Ми затюнили гіперпараметри моделі з метою максимізації recall. Після цього отримали гарний результат і на feature_importances отримали майже однакові ознаки.

## Висновок

На основі отриманих результатів можна стверджувати, що найважливішими ознаками:
1.	Для визначення ймовірності скасування преміум підписки є:

Фічі, роздалені через Space, несуть значення кількісті разів, коли виконувався певний івент

- Chat Conversation Opened, Chat Conversation Started - Дуже багато раз відкривають чат з службою підтримки, тобто в них є якісь проблеми і можливо служба підтримки їм не допомагає
- Transaction Refund - Клієнт повертає велику кількість коштів
- Wallet Opened
- Account Setup Profile Skip
- Add_Vehicle_Success_Make (Buick, Lincoln, Oldsmobile) - Клієнт додає саме недорогі машини, тобто вони можуть бути не популярними
- Sign Out
- User_State(TN, MD, UT, WV) - Клієн знаходеться не найбільш розвиненому штаті

2. Для визначення ймовірності продовження користування сервісом по преміум підписці:

- Order, Order_Premium_Membership - Ті хто робить багато замовлень активні користувачі, все логічно
- Subscription Premium Renew, Subscription_Premium_Renew_Membership (Yearly, Monthly)
- Add Payment Method Success, Add_Payment_Method_Success_Payment_Method (Debit, Credit) - Додають багато Debit і Credit карт, тобто активно отримують гроші
- Chat_Conversation_Opened_Transaction_type (AutoPayment) - Ось тут троби дивно, бо на перший погляд, якщо ти заходиш в чат про AutoPayment, то ти повинен відміняти підписку, але схоже що це використовуються для налуштування оплати
- Add_Vehicle_Success_Temporary (false) - Додають авто не в аренду
- Calculator View - Схоже у вас гарні ціни))
- user_state(NY) - Один з найрозвинутіших штатів, гарний оборот автівок
- Add_Vehicle_Success_Make (Jaguar) - Напевно на дорогі автівки велика комісія, і без підписки ніяк
- Add Vehicle Break - Дуже дивний результ, але він чомусь процює(

